<!-- 
[UML클래스전략패턴](https://github.com/hyeonDD/fluent_python/blob/master/Part14/ex14-1/UML_class_diagram.png)
 -->
# 반복형, 반복자, 제너레이터
데이터를 처리할 때 반복은 기본이다. 메모리에 다 들어가지 않는 데이터셋을 검색할 때는 항목들을 **느긋하게** 가져와야 한다. 즉, 한 번에 하나씩 그리고 필요할 때 가져와야 한다. 이것이 반복자 패턴이 하는 일이다. 이 장에서는 반복자 패턴이 파이썬 언어에 어떻게 구현되어 있는지 설명하므로, 여러분이 반복자를 직접 구현할 필요는 없다.

파이썬은 리스프(폴 그레이엄이 즐겨 사용하는 언어)와 달리 매크로가 없으므로, 반복자 패턴을 추상화할 수 있게 yield 키워드가 2001년에 파이썬 2.2에 추가되었다. yield 키워드는 반복자로 작동하는 제너레이터를 생성할 수 있게 해준다.
> 모든 제너레이터는 반복자다. 제너레이터가 반복자 인터페이스를 완전히 구현하고 있기 때문이다. 그러나 반복자는 디자인 패턴에서 정의한 대로 컬렉션에서 항목을 가져오지만, 제너레이터는 '마술처럼' 항목을 생성할 수 있다. 그렇기 때문에 피보나치 수열 제너레이터가 예제로 널리 사용된다. 무한 수열을 컬렉션에 저장할 수 없기 때문이다. 그렇지만 파이썬 커뮤니티에서는 **반복자**와 **제너레이터**를 거의 동일시하고 있음에 주의하라.

파이썬 3는 제너레이터를 여러 곳에서 사용한다. 예전에는 리스트 전체를 반환했던 내장 함수 range()조차도 지금은 제너레이터와 비슷한 객체를 반환한다. range 형을 이용해서 list를 생성해야 한다면 list(range(100)) 코드처럼 명시적으로 생성해야 한다.

파이썬의 컬렉션은 모두 **반복형**이며, 다음과 같은 연산을 지원하기 위해 내부적으로 반복자를 사용한다.
* for 루프
* 컬렉션형 생성과 확장
* 텍스트 파일을 한 줄씩 반복
* 지능형 리스트/딕셔너리/집합
* 튜플 언패킹
* 함수 호출 시 *를 이용해서 실제 매개변수를 언패킹
이 장에서는 다음과 같은 내용을 다룬다.
* 반복형 객체를 처리하기 위해 내부적으로 iter() 내장 함수를 사용하는 방법
* 파이썬에서 고전적인 반복자 패턴을 구현하는 방법
* 제너레이터가 작동하는 방식을 한 줄씩 상세히 설명
* 고전적인 반복자를 제너레이터 함수나 제너레이터 표현식으로 바꾸는 방법
* 표준 라이브러리에서의 범용 제너레이터 함수의 활용
* 제너레이터를 결합하기 위해 새로 추가된 yield from을 사용하는 방법
* 사례 연구: 대형 데이터셋을 사용하도록 설계된 데이터베이스 변환 유틸리티에서 제너레이터 함수 이용
* 비슷해 보이는 제너레이터와 코루틴이 실제로는 아주 다르며, 혼합해서 사용하면 안 되는 이유

먼저 iter() 함수가 어떻게 시퀀스를 반복할 수 있게 만드는지 알아보자.

# 요약
반복은 파이썬 언어에 아주 깊숙이 자리 잡고 있으므로, 파이썬은 반복을 완전히 꿰고 있다고 말하고 싶다. 파이썬의 특징에 맞게 반복자 패턴을 통합한 것은 디자인 패턴이 모든 언어에 동일하게 적용되지 않는 예를 확실히 보여준다. 파이썬에서는, 예제 14-4에서 '수작업으로' 구현한 고전적인 반복자는 교육용으로는 몰라도 실용성은 없다.

이 장에서는 아주 길 수도 있는 텍스트 파일에 들어 있는 단어들을 반복하는 클래스의 다양한 버전을 만들었다. 제너레이터를 사용한 덕분에 Sentence 클래스를 계속 리팩토링하므로 코드가 간결해지고 가독성도 좋아졌다.

그리고 나서 등차수열 제너레이터를 구현하고 itertools 모듈을 이용해서 코드를 더 간단하게 만드는 방법을 배웠다. 그리고 표준 라이브러리에서 제공하는 24개의 범용 제너레이터 함수에 대해 간략히 살펴봤다.

다음으로 iter() 내장 함수를 깊숙이 들여보았다. 먼저 iter(obj)로 호출할 때 반복자가 어떻게 반환되는지 알아보고 나서, iter(func, sentinel) 형태로 호출해서 임의의 함수로부터 반복자를 만드는 방법도 알아봤다.

실제 사례로, 읽기와 쓰기 논리를 분리시키고, 대용량 데이터셋을 효율적으로 처리하고, 하나이상의 입력 포맷을 지원하기 쉽게 해주는 제너레이터를 사용한 데이터베이스 변환 유틸리의 구현에 대해서도 살펴봤다.

그리고 파이썬 3.3에서 새로 추가된 yield from 구문 및 코루틴에 대해 간략히 언급했다. 이 두 주제는 뒤에서 더 자세히 설명한다.