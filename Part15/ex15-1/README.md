<!-- 
- [UML클래스전략패턴](https://github.com/hyeonDD/fluent_python/blob/master/Part15/ex15-1/UML_class_diagram.png)
 -->
# 이것 다음에 저것: if 문 이외에서의 else 블록
else 절은 if 문뿐만 아니라 for, while, try 문에서도 사용할 수 있다. 비밀스러운 것은 없지만 이 기능은 잘 알려져 있지 않다.
> 필자는 if 이외의 경우에 else를 키워드로 사용하는 것이 옳지 않응 선택이었다고 생각한다. else라는 단어 자체를 생각해보면, '이 루프를 실행하라. 그렇지 않으면 저것을 실행하라' 라는 베타적인 대안을 의미하는데, 실제로 루프 안의 else는 '이 루프를 실행하라. 그러고 나서 이것도'라는 반대 의미를 담고 있다. 그러고 보면 then이라는 키워드를 사용했으면 좋았을 것이다. 그러면 try 문에서도 '이것을 시도해보라. 그러고 나서 이것도'라는 의미가 되어 의도를 적절히 표현할 수 있을 것이다. 그러나 새로운 키워드를 추가하는것은 언어에 급격한 변화를 초래하는 것이라서, 귀도 반 로섬은 키워드 추가를 끔찍이도 싫어한다.

for/else, while/else, try/else의 의미는 서로 밀접한 연관이 있지만, if/else 와는 상당히 다르다. 필자는 처음에 else라는 단어 때문에 그 기능을 이해하기 어려웠지만, 결국 익숙해 졌다.

규칙은 다음과 같다.

---

**for**
for 루프가 완전히 실행된 후에(break 문으로 중간에 멈추지 않고) else 블록이 실행된다.

**while**
조건식이 거짓이 되어 while 루프를 빠져나온 후에 (break 문으로 중간에 멈추지 않고) else 블록이 실행된다.

**try**
try 블록에서 예외가 발생하지 않을 때만 else 블록이 실행된다. 그리고 else 블록에서 발생한 예외는 else블록 앞에 나오는 except 블록에서 처리되지 않는다.

---

그러므로 예외, return, break, continue 문이 복합문의 주요 블록을 빠져나오게 만들면 else 블록은 실행되지 않는다.

이런 문장에 else를 사용하면 코드의 가독성을 높여주고, 제어 플래그의 사용이나 부수적인 if문을 추가할 필요가 없게 해주곤 한다.

일반적으로 루프에서의 else는 다음과 같은 패턴을 따른다.

```

for item in my_list:
    if item.flavor == 'banana':
        break
    else:
        raise ValueError('No banana flavor foudn!')

```
try/except 블록의 경우, 얼핏 보면 else가 필요 없는 것처럼 생각될 수도 있다. 다음 코드에서는 dangerous_call()에서 예외가 발생하지 않는 경우에만 after_call()이 호출된다. 그렇지 않은가?
```
try:
    dangerous_call()
    after_call()
except OSError:
    log('OSError...')
```
그렇지만 try 블록 안에는 예외를 발생시킬 가능성이 있는 코드만 넣어야 한다. 따라서 다음과 같이 구현하는 것이 더 깔끔하다.
```
try:
    dangerous_call()
except:
    log('OSError...)
else:
    after_call()
```
이 코드를 보면 try 블록은 after_call()이 아니라 dangerous_call()에서 발생할 수 있는 에러를 처리하기 위한 것임을 명확히 알 수 있다. 그리고 after_call()은 try 블록 안에서 예외가 발생하지 않는 경우에만 실행된다.

파이썬에서는 try/except를 예외 처리뿐만 아니라 일반적인 제어 흐름을 구현하기 위해서도 많이 사용한다. 파이썬 용어 (https://docs.python.org/3/glossary.html#term-eafp) 에서는 이에 대한 슬로건을 약자로 만들어서 문서화까지 해놓았다.

---

**EAFP**
허락을 구하기보다 용서를 구하는 것이 더 쉽다. 이 말은 예를 들어 올바른 키나 속성이 있다고 가정하고, 그 가정이 잘못되었을 때는 예외를 잡아서 처리하는 파이썬 코딩 스타일을 잘 나타낸다. 깔끔하고 빠른 이 스타일을 적용한 코드에서는 try/except 문을 많이 볼 수 있다. 이 기법은 C 등 다른 언어에서 흔히 볼 수 있는 LBYL 스타일과 대비된다.

---

그러고 나서 파이썬 용어집은 LBYL을 다음과 같이 정의한다.

---

**LBYL**
누울 자리를 보고 다리를 뻗으라. 이런 코딩 스타일은 호출이나 조회를 하기 전에 전제 조건을 명시적으로 검사한다. 이 스타일은 EAFP와 대조적이며, if 문을 아주 많이 사용한다는 특징이 있다. 다중 스레드 환경에서 LBYL 스타일은 '보는' 단계와 '뻗는'단계 사이에 경쟁 조건이 발생할 위험이 있다. 예를 들어 if key in mapping: return mapping[key] 코드는 key를 검사한 후 매핑을 조회하기 전에 다른 스레드에서 key를 제거하면 문제가 발생한다. 이런 문제는 락을 사용하거나 EAFP 접근법을 이용해서 해결할 수 있다.

---

파이썬에서는 EAFP 스타일을 사용하고 있으니, try/except 문에서 else 블록을 잘 이해하고 사용하는 것이 좋다.

이제 이 장의 핵심 주제인 강력한 with 문에 대해 살펴보자.